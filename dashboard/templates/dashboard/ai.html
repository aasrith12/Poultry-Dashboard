{% extends "dashboard/base.html" %}
{% load static %}
{% block content %}
<div class="mx-auto max-w-[1400px]">
  <div class="bg-white border border-auburn/30 rounded-2xl shadow-sm px-4 py-3 mb-5">
    <div class="flex flex-wrap items-center gap-3">
      <span class="font-semibold text-auburn">AI:</span>
      <span class="text-slate-700">
        Pick a logger or an uploaded file from the right panel.
      </span>
      <span id="ai-active-badge" class="ml-auto text-sm px-2 py-1 rounded-full bg-auburn/5 text-auburn border border-auburn/20">
        Nothing selected
      </span>
    </div>
  </div>

  <div class="grid grid-cols-1 md:grid-cols-3 gap-6 items-start">
    <div class="col-span-1 md:col-span-2 space-y-4">
      <div class="bg-white border border-auburn/30 rounded-2xl shadow-sm p-4">
        <div class="flex items-center gap-3 mb-2">
          <h3 class="text-auburn font-semibold">Temperature (C) vs Time (hours)</h3>
          <div class="ml-auto flex items-center gap-2">
            <label for="cutoff" class="text-sm text-slate-600 whitespace-nowrap">
              Cut-off (C):
            </label>
            <input
              id="cutoff"
              type="number"
              step="0.01"
              class="w-28 rounded-lg border border-slate-300 px-2 py-1 text-sm focus:outline-none focus:ring-2 focus:ring-auburn/40"
              value="18.50"
            />
          </div>
        </div>

        <div id="ai-empty" class="h-64 flex items-center justify-center text-slate-500 text-sm">
          Nothing selected or no data.
        </div>
        <div id="ai-chart-wrap" class="h-72 hidden">
          <canvas id="ai-chart"></canvas>
        </div>
      </div>

      <div id="ai-method1" class="bg-white border border-auburn/30 rounded-2xl shadow-sm p-5 hidden">
        <div class="flex items-center justify-between mb-4">
          <h3 class="text-auburn font-semibold">Method 1 - Cut-off Exposure Summary</h3>
          <div class="text-sm text-slate-600">
            Cut-off:&nbsp;
            <span id="ai-cutoff-label" class="text-auburn font-medium">18.50 C</span>
          </div>
        </div>

        <div class="grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-6 gap-3" id="ai-metrics"></div>
        <p class="mt-3 text-[13px] text-slate-600">
          <span class="font-medium">Notes:</span> Exposure is time-weighted assuming linear temperature change between points.
          "Excursions" counts upward crossings through the cut-off.
        </p>
      </div>

      <div id="ai-method2" class="bg-white border border-auburn/30 rounded-2xl shadow-sm p-5 hidden">
        <div class="flex items-center justify-between mb-3">
          <h3 class="text-auburn font-semibold">Method 2 - FEFO Shelf-Life Estimation (Monte Carlo Simulation)</h3>
          <span class="text-sm text-slate-600">
            Cut-off: <span id="ai-cutoff-label-2" class="text-auburn font-medium">18.50 C</span>
          </span>
        </div>

        <div class="overflow-x-auto">
          <table class="w-full text-sm border border-slate-200 rounded-xl overflow-hidden">
            <thead class="bg-auburn/10 text-slate-800">
              <tr>
                <th class="px-4 py-2 text-left font-semibold">Time &gt; Cut-off (h)</th>
                <th class="px-4 py-2 text-left font-semibold">Risk of Loss (%)</th>
                <th class="px-4 py-2 text-left font-semibold">Shelf-Life (days)</th>
                <th class="px-4 py-2 text-left font-semibold">Remaining (%)</th>
                <th class="px-4 py-2 text-left font-semibold">Reduction (%)</th>
              </tr>
            </thead>
            <tbody id="ai-fefo-body"></tbody>
          </table>
        </div>

        <div id="ai-fefo-summary" class="mt-4 bg-auburn/5 rounded-xl p-4 text-slate-700 text-sm"></div>
      </div>
    </div>

    <div class="space-y-4">
      <div class="bg-white border border-auburn/30 rounded-2xl shadow-sm p-4">
        <h3 class="text-auburn font-semibold mb-3">Select Logger</h3>
        <div id="ai-devices-empty" class="text-slate-500 text-sm hidden">No devices found.</div>
        <div id="ai-devices-loading" class="text-slate-500 text-sm hidden">Loading devices...</div>
        <div id="ai-devices-list" class="flex flex-col gap-2"></div>
      </div>

      <div class="bg-white border border-auburn/30 rounded-2xl shadow-sm p-4">
        <h3 class="text-auburn font-semibold mb-3">Upload History</h3>
        <div id="ai-history-empty" class="text-slate-500 text-sm">No uploads yet.</div>
        <div id="ai-history-list" class="flex flex-col gap-2"></div>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
<script src="{% static 'dashboard/js/ai.js' %}"></script>
{% endblock %}
